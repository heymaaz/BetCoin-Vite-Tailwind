<template>
    <div class="relative px-4 py-4 flex flex-col justify-between items-center">
        BTC
        <div id="tester" class="text-3xl font-bold leading-none flex items-center">
            <!-- Plotly chart will be drawn inside this DIV -->
        </div>
        <!--Add button for generate predictions-->
        <button class="block px-4 py-3 mb-2 leading-loose text-xs text-center text-white font-semibold bg-blue-600 hover:bg-blue-700  rounded-xl" @click="generatePredictions">Generate Predictions</button>
    </div>
</template>
<script setup>

import { ref, onMounted } from 'vue';

const tester = ref('tester');

//const startDate = "2021-06-22 00:00:00";
//const targetValues = [0.5468,0.6383,0.6731,0.6111,0.6162,0.6484,0.6444,0.7063,0.7063,0.6591,0.6556,0.6732,0.696,0.6526,0.6648,0.6522,0.6215,0.6369,0.6246,0.6364,0.6288,0.6192,0.6197,0.5979,0.5893,0.5821,0.5866,0.557,0.5284,0.5719,0.592,0.6091,0.6085,0.6069,0.6234,0.6451,0.7327,0.7488,0.7521,0.746,0.7242,0.738,0.7136,0.731,0.7327,0.7474,0.8162,0.7788,0.817,0.8511,1.0105,0.966,1.0901,1.2791,1.2839,1.1855,1.0978,1.1431,1.2347,1.2629,1.2158,1.226,1.2457,1.1353,1.1735,1.0712,1.1918,1.1459,1.1408,1.1002,1.1856,1.2362,1.2533,1.2907,1.2548,1.3076,1.3894,1.1292,1.0998,1.0868,1.0552,1.0787,1.1181,1.0643,1.0963,1.1207,1.0902,1.0661,1.0751,1.0483,0.9216,0.8743,1.0033,1.0016,0.944,0.94,0.9436,0.9218,0.8928,0.9268,0.9533,1.0422,1.0359,1.0552,1.0425,1.0839,1.0765,1.0678,1.0636,1.1604,1.1352,1.1364,1.1018,1.1275,1.1336,1.1413,1.1343,1.0944,1.0827,1.0911,1.1455,1.0886,1.0885,1.0934,1.0821,1.0951,1.1075,0.995,1.0579,1.0825,1.0846,1.1128,1.0915,1.1349,1.2101,1.2004,1.1581,1.151,1.2198,1.2815,1.2571,1.1902,1.2142,1.1883,1.1892,1.1879,1.172,1.0877,1.0953,1.0406,1.0892,1.0965,1.0569,1.0354,1.0661,1.0326,1.0438,0.9394,0.9452,0.9687,0.9898,0.9983,0.9899,0.9716,0.9211,0.8449,0.8045,0.8255,0.8154,0.8622,0.8583,0.7992,0.8392,0.8393,0.7818,0.8103,0.8262,0.8051,0.7966,0.8262,0.835,0.8798,0.9467,0.9537,0.9941,0.9115,0.9252,0.92,0.9269,0.8515,0.8171,0.8386,0.8297,0.8507,0.8586,0.8324,0.8228,0.7726,0.7791,0.7634,0.7452,0.753,0.7399,0.7703,0.7987,0.768,0.7732,0.7791,0.7784,0.7617,0.7509,0.7381,0.7199,0.6368,0.5966,0.6283,0.6118,0.618,0.6193,0.6088,0.6111,0.6174,0.6013,0.6174,0.6284,0.6006,0.6102,0.6555,0.6656,0.6825,0.8314,0.8763,0.8697,0.8253,0.7591,0.8223,0.8057,0.8012,0.8515,0.8366,0.769,0.784,0.8215,0.7769,0.7018,0.7209,0.6967,0.6963,0.7699,0.7508,0.7215,0.7809,0.7839,0.7687,0.7515,0.7127,0.754,0.7251,0.7197,0.7207,0.7658,0.7361,0.8029,0.7857,0.7602,0.7748,0.7657,0.7919,0.7935,0.7965,0.8194,0.8057,0.8373,0.8366,0.8376,0.8428,0.8239,0.8327,0.858,0.8641,0.8577,0.8613,0.8148,0.8277,0.824,0.8432,0.826,0.8164,0.7595,0.7871,0.7549,0.7622,0.7543,0.6948,0.7152,0.7232,0.7262,0.7858,0.7808,0.7519,0.7699,0.7749,0.7517,0.7328,0.7179,0.7057,0.6981,0.6931,0.642,0.6522,0.6428,0.6116,0.5845,0.607,0.6143,0.6047,0.6459,0.5981,0.6022,0.5808,0.5662,0.4873,0.513,0.4172,0.3856,0.4228,0.4262,0.4481,0.4231,0.438,0.4056,0.4205,0.4101,0.4145,0.4218,0.4052,0.4086,0.406,0.392,0.3819,0.3863,0.3891,0.4187,0.4217,0.398,0.4055,0.3904,0.3925,0.3953,0.4026,0.4076,0.4006,0.4002,0.3815,0.3599,0.3433,0.3118,0.3214,0.3436,0.3132,0.321,0.3075,0.3264,0.3227,0.3294,0.3223,0.3358,0.3672,0.3676,0.3592,0.3537,0.3375,0.3296,0.3321,0.3139,0.3156,0.3215,0.3287,0.3252,0.3324,0.3422,0.3402,0.3448,0.3255,0.3152,0.3116,0.3237,0.3338,0.3342,0.3505,0.3433,0.3653,0.3729,0.3635,0.3669,0.3578,0.3592,0.3586,0.3362,0.3372,0.3594,0.3739,0.3679,0.3879,0.3792,0.3791,0.3714,0.3695,0.371,0.3764,0.3715,0.3722,0.3787,0.3672,0.3814,0.3802,0.3796,0.378,0.3757,0.3751,0.377,0.3795,0.3704,0.3344,0.3368,0.3449,0.344,0.3472,0.3456,0.3491,0.3393,0.3346,0.3224,0.3337,0.3267,0.3277,0.3331,0.3314,0.3297,0.3317,0.3329,0.3212,0.3369,0.3396,0.3568,0.3573,0.3552,0.3598,0.3326,0.3415,0.3261,0.3552,0.3762,0.3576,0.3848,0.414,0.3936,0.4862,0.5069,0.4878,0.4917,0.4683,0.4457,0.4489,0.4877,0.4799,0.4754,0.4485,0.4621,0.4795,0.4887,0.4934,0.5177,0.517,0.5325,0.4939,0.4861,0.4881,0.4791,0.4883,0.4818,0.4766,0.4804,0.4658,0.4504,0.4465,0.4614,0.4653,0.4688,0.4529,0.4605,0.4689,0.4615,0.4744,0.4701,0.4582,0.4641,0.4636,0.4497,0.4548,0.5064,0.493,0.4709,0.4648,0.4059,0.3331,0.3942,0.3843,0.3636,0.3408,0.3776,0.3888,0.3752,0.3819,0.3829,0.3841,0.3608,0.3645,0.3757,0.3815,0.4018,0.4078,0.396,0.3962,0.3888,0.3981,0.4078,0.3969,0.3961,0.3873,0.3895,0.3893,0.3914,0.3835,0.3941,0.3889,0.3865,0.3809,0.3874,0.3952,0.3853,0.378,0.3511,0.3545,0.3499,0.3389,0.3482,0.3449,0.3492,0.3543,0.3517,0.3457,0.3658,0.3675,0.3558,0.3421,0.3451,0.3389,0.3387,0.3482,0.3436,0.3472,0.338,0.3443,0.3442,0.3452,0.349,0.3507,0.3728,0.3748,0.3858,0.3953,0.3845,0.3855,0.3868,0.3782,0.3928,0.4129,0.4034,0.4004,0.4234,0.4078,0.417,0.4092,0.4128,0.4078,0.4134,0.3934,0.4057,0.4131,0.4098,0.4117,0.4106,0.3984,0.392,0.4036,0.3975,0.3819,0.3817,0.3833,0.3747,0.3703,0.3819,0.4011,0.3841,0.395,0.3943,0.3863,0.3984,0.3919,0.3953,0.3882,0.3783,0.3778,0.3779,0.3785,0.3762,0.3835,0.3772,0.3774,0.3735,0.3668,0.3695,0.3801,0.3889,0.3706,0.37,0.3638,0.3714,0.3724,0.3724,0.3589,0.3647,0.3798,0.3739,0.3857,0.3734,0.4696,0.4213,0.4438,0.4259,0.4429,0.4479,0.479,0.5144,0.5425,0.5319,0.5374,0.5095,0.518,0.4959,0.5026,0.5055,0.5028,0.5126,0.5048,0.5054,0.5176,0.5167,0.5049,0.5125,0.5227,0.5192,0.5209,0.5109,0.5324,0.4911,0.4752,0.4491,0.4719,0.4647,0.4611,0.4695,0.4618,0.4667,0.4796,0.478,0.4705,0.4649,0.4645,0.4632,0.4608,0.4671,0.4582,0.449,0.4283,0.4289,0.4303,0.4207,0.4305,0.424,0.4253,0.4273,0.4425,0.4484,0.4596,0.4675,0.4685,0.4575,0.4618,0.4651,0.453,0.4538,0.4684,0.4714,0.482,0.4946,0.5205,0.5166,0.5065,0.5244,0.5188,0.5359,0.509,0.53,0.5183,0.5236,0.538,0.5067,0.5208,0.5251,0.5192,0.4801,0.4801,0.4759,0.4794,0.4868,0.4936,0.4929,0.4999,0.4938,0.4961,0.4865,0.4903,0.479,0.4838,0.4647,0.4747,0.4729,0.4732,0.4845,0.489,0.4872,0.4777,0.4622,0.4687,0.4704,0.468,0.478,0.4753,0.471,0.8153,0.7179,0.7145,0.7468,0.7374,0.7779,0.8199,0.7942,0.7713,0.7331,0.7384,0.7021,0.7089,0.7161,0.7139,0.712,0.7121,0.7046,0.6976,0.7069,0.685,0.663,0.6356,0.6288,0.624,0.6236,0.6418,0.6433,0.6331,0.6318,0.6276,0.6256,0.6343,0.6104,0.5889,0.5064,0.5062,0.5199,0.5384,0.5245,0.521,0.5301,0.5187,0.5258,0.5231,0.5236,0.5232,0.5398,0.5284,0.511,0.498,0.4988,0.5047,0.5087,0.5056,0.5033,0.505,0.505,0.5038,0.4969,0.4744,0.4804,0.4832,0.4892,0.5005,0.4998,0.4925,0.503,0.514,0.5212,0.5071,0.5122,0.5076,0.5021,0.5056,0.5019,0.4993,0.5098,0.5215,0.5149,0.5241,0.5123,0.539,0.5326,0.5227,0.5255,0.5216,0.5174,0.5027,0.4965,0.4888,0.483,0.4851,0.4865,0.4874,0.4978,0.4912,0.4878,0.5197,0.5149,0.5208,0.5226,0.5475,0.5588,0.5552,0.5533,0.543,0.5446,0.5561,0.578,0.5996,0.6085,0.6054,0.6121,0.6149,0.6607,0.7148,0.685,0.6869,0.6665,0.6595,0.6626,0.6613,0.6702,0.6296,0.6481,0.6119,0.6133,0.6106,0.6258,0.6122,0.5788,0.6109,0.6209,0.6212,0.6228,0.6157,0.6039,0.6107,0.6091,0.6063,0.6125,0.6208,0.6229,0.6245,0.621,0.64,0.6432,0.6721,0.6584,0.6617,0.6187,0.6192,0.6275,0.6316,0.6156,0.6203,0.6103,0.6125,0.6047,0.6171,0.6241,0.6244,0.6195,0.6121,0.6462,0.6219,0.634,0.6346,0.623,0.6207,0.6156,0.6294,0.6246,0.5823,0.5868,0.5757,0.5679,0.5515,0.5776,0.5669,0.6008,0.6019,0.5699,0.5747,0.5763,0.5757,0.5757,0.5685,0.552,0.5443,0.5534,0.5464,0.5275,0.5183,0.5181,0.5138,0.5323,0.5303,0.5241,0.5352,0.5107,0.5033,0.5058,0.5105,0.5186,0.5032,0.5069,0.505,0.5138,0.5147,0.5262,0.5239,0.5261,0.5315,0.5247,0.5378,0.5622,0.5643,0.5496,0.5571,0.5626,0.5622,0.5491,0.541,0.5342,0.545,0.5425,0.5506,0.5861,0.575,0.5867,0.6013,0.6442,0.6271,0.6477,0.5912,0.6121,0.627,0.62,0.6197,0.608,0.723,0.688,0.6891,0.669,0.6342,0.6031,0.6067];

let startDate;
let targetValues;

let lastDate;

// WebSocket connection
let socket;

onMounted(() => {
    // Initialize WebSocket connection
    socket = new WebSocket("wss://0glkdb0fh8.execute-api.us-east-1.amazonaws.com/production");
    
    socket.onopen = () => {
        console.log('WebSocket Connected');
        // Optionally, send a message to server to request initial data
        socket.send(JSON.stringify({ 
            action: 'requestInitialData',
            data: "BTC" 
        }));
    };
    
    socket.onmessage = (event) => {
        console.log("Message received.");
        const data = JSON.parse(event.data);
        if (data.type) {
            console.log(data.type);
            if (data.type === 'initialData') {
                // Update startDate and targetValues with data received from server
                startDate = data.startDate;
                targetValues = data.targetValues;
                plotInitialData();
            } else if (data.type === 'predictionData') {
                // Update chart with received prediction data
                updateChartWithPredictions(data.predictions);
            }
        }
        //startDate.value = data.startDate;
        //targetValues.value = data.targetValues;
        //plotInitialData();
        /*
        const data = JSON.parse(event.data);
        if (data.type === 'initialData') {
            // Update startDate and targetValues with data received from server
            startDate.value = data.startDate;
            targetValues.value = data.targetValues;
            plotInitialData();
        } else if (data.type === 'predictionData') {
            // Update chart with received prediction data
            updateChartWithPredictions(data.predictions);
        }
        */
    };
    
    socket.onerror = (error) => {
        console.error('WebSocket Error:', error);
    };
});

function plotInitialData() {
    function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
    }
    
    // Convert the start date to a Date object
    const startDateObj = new Date(startDate);
    
    // Generate dates for the x-axis
    const dates = targetValues.map((_, index) => {
        return addDays(startDateObj, index).toISOString().split('T')[0];
    });
    
    //store the last date in the variable
    lastDate = dates[dates.length - 1];
    
    // Define the data for the plot
    const data = [{
        x: dates,
        y: targetValues,
        type: 'scatter' // Change this to 'bar' if you prefer a bar chart
    }];
    
    // Layout configuration
    const layout = {
        title: 'Crypto Price Tracker',
        xaxis: {
            title: 'Date',
        },
        yaxis: {
            title: 'Price',
        }
    };
    
    // Plot the graph
    Plotly.newPlot(tester.value, data, layout);
}

    // Assuming Plotly.js is already included in your HTML via a script tag or npm
    
    // Your starting date and target values
    /*
    const startDate = "2021-06-22 00:00:00";
    const targetValues = [32509.56,33678.07,34663.09,31584.45,32283.65,34700.34,34494.89,35911.73,35045,33504.69,33786.55,34669.13,35286.51,33690.14,34220.01,33862.12,32875.71,33815.81,33502.87,34258.99,33086.63,32729.77,32820.02,31880,31383.87,31520.07,31778.56,30839.65,29790.35,32144.51,32287.83,33634.09,34258.14,35381.02,37237.6,39457.87,40019.56,40016.48,42206.37,41461.83,39845.44,39147.82,38207.05,39723.18,40862.46,42836.87,44572.54,43794.37,46253.4,45584.99,45511,44399,47800,47068.51,46973.82,45901.29,44695.95,44705.29,46760.62,49322.47,48821.87,49239.22,49488.85,47674.01,48973.32,46843.87,49069.9,48895.35,48767.83,46982.91,47100.89,48810.52,49246.64,49999.14,49915.64,51756.88,52663.9,46863.73,46048.31,46395.14,44850.91,45173.69,46025.24,44940.73,47111.52,48121.41,47737.82,47299.98,48292.74,47241.75,43015.62,40734.38,43543.61,44865.26,42810.57,42670.64,43160.9,42147.35,41026.54,41524.28,43824.1,48141.61,47634.9,48200.01,49224.94,51471.99,55315,53785.22,53951.43,54949.72,54659,57471.35,55996.93,57367,57347.94,61672.42,60875.57,61528.33,62009.84,64280.59,66001.41,62193.15,60688.22,61286.75,60852.22,63078.78,60328.81,58413.44,60575.89,62253.71,61859.19,61299.8,60911.11,63219.99,62896.48,61395.01,60937.12,61470.61,63273.59,67525.83,66947.66,64882.43,64774.26,64122.23,64380,65519.1,63606.74,60058.87,60344.87,56891.62,58052.24,59707.51,58622.02,56247.18,57541.27,57138.29,58960.36,53726.53,54721.03,57274.88,57776.25,56950.56,57184.07,56480.34,53601.05,49152.47,49396.33,50441.92,50588.95,50471.19,47545.59,47140.54,49389.99,50053.9,46702.75,48343.28,48864.98,47632.38,46131.2,46834.48,46681.23,46914.16,48889.88,48588.16,50838.81,50820,50399.66,50775.49,50701.44,47543.74,46464.66,47120.87,46216.93,47722.65,47286.18,46446.1,45832.01,43451.13,43082.31,41566.48,41679.74,41864.62,41822.49,42729.29,43902.66,42560.11,43059.96,43084.29,43071.66,42201.62,42352.12,41660.01,40680.91,36445.31,35071.42,36244.55,36660.35,36958.32,36809.34,37160.1,37716.56,38166.84,37881.76,38466.9,38694.59,36896.36,37311.61,41574.25,41382.59,42380.87,43839.99,44042.99,44372.72,43495.44,42373.73,42217.87,42053.66,42535.94,44544.86,43873.56,40515.7,39974.44,40079.17,38386.89,37008.16,38230.33,37250.01,38327.21,39219.17,39116.72,37699.07,43160,44421.2,43892.98,42454,39148.66,39397.96,38420.81,37988,38730.63,41941.71,39422,38729.57,38807.36,37777.34,39671.37,39280.33,41114,40917.9,41757.51,42201.13,41262.11,41002.25,42364.13,42882.76,43991.46,44313.16,44511.27,46827.76,47122.21,47434.8,47067.99,45510.34,46283.49,45811,46407.35,46580.51,45497.55,43170.47,43444.19,42252.01,42753.97,42158.85,39530.45,40074.94,41147.79,39942.38,40551.9,40378.71,39678.12,40801.13,41493.18,41358.19,40480.01,39709.18,39441.6,39450.13,40426.08,38112.65,39235.72,39742.07,38596.11,37630.8,38468.35,38525.16,37728.95,39690,36552.97,36013.77,35472.39,34038.4,30076.31,31017.1,29103.94,29029.75,29287.05,30086.74,31328.89,29874.01,30444.93,28715.32,30319.23,29201.01,29445.06,30293.94,29109.15,29654.58,29542.15,29201.35,28629.8,29031.33,29468.1,31734.22,31801.04,29805.83,30452.62,29700.21,29864.04,29919.21,31373.1,31125.33,30204.77,30109.93,29091.88,28424.7,26574.53,22487.41,22136.41,22583.72,20401.31,20468.81,18970.79,20574,20573.89,20723.52,19987.99,21110.13,21237.69,21491.19,21038.07,20742.56,20281.29,20123.01,19942.21,19279.8,19252.81,19315.83,20236.71,20175.83,20564.51,21624.98,21594.75,21591.83,20862.47,19963.61,19328.75,20234.87,20588.84,20830.04,21195.6,20798.16,22432.58,23396.62,23223.3,23152.19,22684.83,22451.07,22579.68,21310.9,21254.67,22952.45,23842.93,23773.75,23643.51,23293.32,23268.01,22987.79,22818.37,22622.98,23312.42,22954.21,23174.39,23810,23149.95,23954.05,23934.39,24403.68,24441.38,24305.24,24094.82,23854.74,23342.66,23191.2,20834.39,21140.07,21515.61,21399.83,21529.12,21368.08,21559.04,20241.05,20037.6,19555.61,20285.73,19811.66,20050.02,20131.46,19951.86,19831.9,20000.3,19796.84,18790.61,19292.84,19319.77,21360.11,21648.34,21826.87,22395.74,20173.57,20226.71,19701.88,19803.3,20113.62,19416.18,19537.02,18875,18461.36,19401.63,19289.91,18920.5,18807.38,19227.82,19079.13,19412.82,19591.51,19422.61,19310.95,19056.8,19629.08,20337.82,20158.26,19960.67,19530.09,19417.96,19439.02,19131.87,19060,19155.53,19375.13,19176.93,19069.39,19262.98,19549.86,19327.44,19123.97,19041.92,19164.37,19204.35,19570.4,19329.72,20080.07,20771.59,20295.11,20591.84,20809.67,20627.48,20490.74,20483.62,20151.84,20207.82,21148.52,21299.37,20905.58,20591.13,18547.23,15922.81,17601.15,17070.31,16812.08,16329.85,16619.46,16900.57,16662.76,16692.56,16700.45,16700.68,16280.23,15781.29,16226.94,16603.11,16598.95,16522.14,16458.57,16428.78,16212.91,16442.53,17163.64,16977.37,17092.74,16885.2,17105.7,16966.35,17088.96,16836.64,17224.1,17128.56,17127.49,17085.05,17209.83,17774.7,17803.15,17356.34,16632.12,16776.52,16738.21,16438.88,16895.56,16824.67,16821.43,16778.5,16836.12,16832.11,16919.39,16706.36,16547.31,16633.47,16607.48,16542.4,16616.75,16672.87,16675.18,16850.36,16831.85,16950.65,16943.57,17127.83,17178.26,17440.66,17943.26,18846.62,19930.01,20954.92,20871.5,21185.65,21134.81,20677.47,21071.59,22667.21,22783.55,22707.88,22916.45,22632.89,23060.94,23009.65,23074.16,23022.6,23742.3,22826.15,23125.13,23732.66,23488.94,23431.9,23326.84,22932.91,22762.52,23240.46,22963,21796.35,21625.19,21862.55,21783.54,21773.97,22199.84,24324.05,23517.72,24569.97,24631.95,24271.76,24842.2,24452.16,24182.21,23940.2,23185.29,23157.07,23554.85,23492.09,23141.57,23628.97,23465.32,22354.34,22346.57,22430.24,22410,22197.96,21705.44,20362.22,20150.69,20455.73,21997.11,24113.48,24670.41,24285.66,24998.78,27395.13,26907.49,27972.87,27717.01,28105.47,27250.97,28295.41,27454.47,27462.95,27968.05,27124.91,27261.07,28348.6,28028.53,28465.36,28452.73,28171.87,27800,28165.47,28170.01,28033.82,27906.33,27938.38,28323.76,29637.34,30200.42,29888.07,30373.84,30466.93,30295.09,30304.65,29430.27,30380.01,28797.1,28243.65,27262.84,27816.85,27590.6,27510.93,28300.79,28415.29,29472.77,29311.7,29230.45,29233.21,28068.26,28669.86,29026.16,28838.16,29505.61,28848.2,28430.1,27668.79,27628.27,27598.75,26968.62,26795.01,26775.28,26917.62,27162.14,27033.84,27405.61,26821.28,26880.26,27102.43,26747.78,26849.27,27219.61,26329.01,26473.79,26705.92,26854.27,28065,27736.4,27694.4,27210.35,26817.93,27242.59,27069.22,27115.21,25728.2,27230.08,26339.34,26498.61,26477.81,25841.21,25925.55,25905.19,25934.25,25128.6,25598.49,26345,26516.99,26339.97,26844.35,28307.99,29993.89,29884.92,30688.5,30527.43,30462.66,30267.99,30692.44,30077.41,30447.31,30472,30585.9,30617.03,31156.2,30766.51,30504.81,29895.43,30344.7,30284.63,30160.71,30411.57,30622.1,30380,31454.23,30312.01,30289.52,30231.99,30138,29859.13,29909.21,29800,29901.72,29794,30083.75,29176.5,29228.91,29351.96,29222.78,29314.14,29352.9,29281.09,29232.25,29705.99,29186.01,29193.64,29113.99,29072.13,29088.42,29211.06,29770.42,29581.99,29455.75,29426.03,29430.17,29303.84,29430.93,29200,28730.51,26623.41,26054,26100.01,26189.99,26126.92,26056,26432.72,26180.05,26060.01,26017.37,26101.77,26120,27716.34,27299.99,25940.78,25805.05,25869.51,25971.21,25826.02,25792.1,25759.95,26255,25910.5,25901.61,25841.61,25162.52,25840.1,26222,26522.73,26600,26559.67,26527.51,26762.51,27210.26,27125,26568.08,26580.14,26575.96,26248.38,26304.81,26221.67,26372.99,27021.39,26906.96,26962.56,27992.57,27494.51,27426.46,27778.57,27410.39,27931.09,27956.67,27917.05,27590.12,27390.12,26875.52,26759.63,26862,26852.48,27154.15,28500.78,28395.91,28320,28713.71,29669.04,29909.8,29992.46,33069.99,33922.73,34496.05,34151.66,33892.02,34081,34525.89,34474.73,34639.77,35421.43,34941.59,34716.78,35062.07,35011.88,35046.09,35399.12,35624.72,36701.09,37301.63,37130,37064.13,36462.93,35551.19,37858.2,36163.51,36613.92,36568.1,37359.86,37448.78,35741.65,37408.34,37294.28,37713.57,37780.67,37447.43,37242.7,37818.87,37854.64,37723.96,38682.52,39450.35,39972.26,41991.1,44073.32,43762.69,43273.14,44170.99,43713.6,43789.51,41253.4,41492.39,42869.03,43022.26,41940.3,42278.03,41374.65,42657.8,42275.99,43668.93,43861.8,43969.04,43702.16,42991.5,43576.13,42508.93,43428.85,42563.76,42066.95,42140.28,42283.58,44179.55,44946.91,42845.23,44151.1,44145.11,43968.32,43929.02,46951.04,46110,46653.99,46339.16,42782.73,42847.99,41732.35,42511.1,43137.95,42776.1,41327.5,41659.03,41696.04,41580.33,39568.02,39897.6,40084.88,39961.09,41823.51,42120.63,42031.06,43302.7,42941.1,42580,43082.94,43200,43011.09,42582.88,42708.7,43098.95,44349.6,45288.65,47132.77,47751.09,48299.99,49917.27,49699.59,51795.17,51880,52124.11,51642.64,52137.67,51774.73,52258.82,51849.39,51288.42,50744.15,51568.22,51728.85,54476.47,57037.34,62432.1,61130.98,62387.9,61987.28,63113.97,68245.71,63724.01,66074.04,66823.17,68124.19,68313.27,68955.88,72078.1,71452.01,73072.41,71388.94,69499.85,65300.63,65780];
    */
    // Helper function to add days to a date
    /*
    function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
    }
    
    // Convert the start date to a Date object
    const startDateObj = new Date(startDate);
    
    // Generate dates for the x-axis
    const dates = targetValues.map((_, index) => {
        return addDays(startDateObj, index).toISOString().split('T')[0];
    });
    
    //store the last date in the variable
    lastDate = dates[dates.length - 1];
    
    // Define the data for the plot
    const data = [{
        x: dates,
        y: targetValues,
        type: 'scatter' // Change this to 'bar' if you prefer a bar chart
    }];
    
    // Layout configuration
    const layout = {
        title: 'Crypto Price Tracker',
        xaxis: {
            title: 'Date',
        },
        yaxis: {
            title: 'Price',
        }
    };
    
    // Plot the graph
    Plotly.newPlot(tester.value, data, layout);
    
});
*/

function generatePredictions() {
    // Send last 100 days of data to the prediction model to get the next 50 days of predictions
    // Update the chart and add the predictions in a different color
    alert('Predictions generated!');
    
    let mean = [
    0.639705658,
    0.6649913192,
    0.696793735,
    0.7190288305,
    0.7290815115,
    0.74688375,
    0.7678017616,
    0.7612789273,
    0.760104537,
    0.7640670538,
    0.7538498044,
    0.7541520596,
    0.7598429918,
    0.784850359,
    0.8022325635,
    0.8022296429,
    0.7796241045,
    0.7826293707,
    0.7821788192,
    0.7872180939,
    0.7923297882,
    0.7733761072,
    0.7914899588,
    0.8147072792,
    0.8382781744,
    0.8228770494,
    0.8464785814,
    0.8504730463,
    0.8408216834,
    0.8356372714,
    0.8141300082,
    0.8276489973,
    0.8309347034,
    0.8469527364,
    0.8565158248,
    0.8482916355,
    0.8318018317,
    0.835067749,
    0.8258187771,
    0.8295067549,
    0.8280019164,
    0.8266102672,
    0.8166734576,
    0.8237531185,
    0.839619875,
    0.8431777954,
    0.8412103057,
    0.8398836255,
    0.8501921296,
    0.8091678619];
    
    let quantiles = {
        "0.1": [
        0.5884149075,
        0.623404026,
        0.6511483788,
        0.6632561088,
        0.6725854874,
        0.6894027591,
        0.7178953886,
        0.7159662247,
        0.7009515762,
        0.7032524943,
        0.6888546348,
        0.7090600133,
        0.6954250932,
        0.7318389416,
        0.7545242906,
        0.737716198,
        0.7155655622,
        0.7184060812,
        0.7082724571,
        0.7101788521,
        0.7217206359,
        0.6896458864,
        0.6952739358,
        0.7220531702,
        0.7204521894,
        0.7391037941,
        0.7537968755,
        0.754123807,
        0.7600670457,
        0.7382717133,
        0.6777760386,
        0.729752183,
        0.7270835042,
        0.7383328676,
        0.7513065934,
        0.7262706757,
        0.7283388972,
        0.732046783,
        0.736707747,
        0.7140669823,
        0.7155991197,
        0.7044141293,
        0.6973670125,
        0.6834961772,
        0.719942987,
        0.7144036293,
        0.7405794859,
        0.7125345469,
        0.7122129798,
        0.6922255754
        ],
        "0.9": [
        0.6890947223,
        0.7265219092,
        0.7561680079,
        0.7895020247,
        0.7888994813,
        0.8085472584,
        0.823603332,
        0.8233091235,
        0.8206241727,
        0.8410409689,
        0.8213725686,
        0.8363751769,
        0.8284409642,
        0.8692988753,
        0.862332046,
        0.8896708488,
        0.8597679734,
        0.8547602892,
        0.887992382,
        0.9007421136,
        0.8971310854,
        0.8780106306,
        0.8963346481,
        0.9460992813,
        0.9591801763,
        0.9031637311,
        0.9692445993,
        0.9778612256,
        0.9298126698,
        0.9642156959,
        0.9339007735,
        0.9634755254,
        0.9627147913,
        0.9949221611,
        0.9857845902,
        0.9467881918,
        0.9489067793,
        0.9460746646,
        0.9425470233,
        0.9359169602,
        0.9800890684,
        0.9439857006,
        0.9429253936,
        0.9425859451,
        0.9530172944,
        0.9644372463,
        0.9699730277,
        0.963979125,
        0.9861076474,
        0.9559313059
        ]
    };
    
    // Helper function to add days to a date
    function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
    }
    
    // Convert the start date to a Date object
    const startDateObj = new Date(lastDate);
    
    // Generate dates for the x-axis
    const dates = targetValues.map((_, index) => {
        return addDays(startDateObj, index).toISOString().split('T')[0];
    });
    
    
    // Update the chart with the predictions
    const data_mean = [{
        x: dates,
        y: mean,
        type: 'scatter',
        mode: 'lines',
        line: {
            color: 'red'
        }
    }];
    
    const data_9 = [{
        x: dates,
        y: quantiles["0.9"],
        type: 'scatter',
        mode: 'lines',
        line: {
            color: 'green'
        }
    }];
    
    const data_1 = [{
        x: dates,
        y: quantiles["0.1"],
        type: 'scatter',
        mode: 'lines',
        line: {
            color: 'blue'
        }
    }];
    
    //Name the new trace as 'Mean', 'Upper Bound' and 'Lower Bound
    data_mean[0].name = 'Mean';
    data_9[0].name = 'Upper Bound';
    data_1[0].name = 'Lower Bound';
    Plotly.addTraces(tester.value, data_mean);
    Plotly.addTraces(tester.value, data_9);
    Plotly.addTraces(tester.value, data_1);
    
    // Update trace 0 to "Actual"
    Plotly.restyle(tester.value, {name: 'Actual'}, 0);
    
}

defineExpose({
    generatePredictions
});

</script>
